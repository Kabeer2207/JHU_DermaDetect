<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analyzing Image - Skin Health Center</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app-layout">
      <!-- Header -->
      <header class="header">
        <div class="container">
          <div class="header-content">
            <button class="back-button" onclick="goBack()">‚Üê</button>
            <a href="index.html" class="logo">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="margin-right: 8px"
              >
                <path d="M3 21h18l-9-18z" />
                <path d="M12 9v4" />
                <path d="M12 17h.01" />
              </svg>
              DermaDetect
            </a>
            <nav class="nav-icons">
              <div
                class="nav-icon theme-toggle"
                title="Toggle Theme"
                onclick="toggleTheme()"
              >
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  class="theme-icon-light"
                >
                  <circle cx="12" cy="12" r="5" />
                  <path
                    d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                  />
                </svg>
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  class="theme-icon-dark"
                  style="display: none"
                >
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                </svg>
              </div>
            </nav>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <div class="container">
          <!-- Analysis Section -->
          <section class="analysis-section">
            <h1 class="analysis-title">Analyzing Image...</h1>
            <div class="analysis-spinner"></div>
            <p class="analysis-description">
              AI is analyzing your image for skin conditions. Please wait...
            </p>
          </section>

          <!-- Modern Progress Steps -->
          <section class="progress-section">
            <div class="progress-timeline">
              <div class="timeline-item completed">
                <div class="timeline-marker">
                  <div class="marker-icon">‚úì</div>
                </div>
                <div class="timeline-content">
                  <h3>Image Uploaded</h3>
                  <p>Successfully received</p>
                  <span class="status-badge completed">Complete</span>
                </div>
              </div>

              <div class="timeline-item active">
                <div class="timeline-marker processing">
                  <div class="marker-icon">
                    <div class="spinner"></div>
                  </div>
                </div>
                <div class="timeline-content">
                  <h3>AI Analysis</h3>
                  <p>Processing with neural network</p>
                  <span class="status-badge processing">Analyzing...</span>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker">
                  <div class="marker-icon">üìÑ</div>
                </div>
                <div class="timeline-content">
                  <h3>Generate Report</h3>
                  <p>Compiling diagnosis data</p>
                  <span class="status-badge pending">Pending</span>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker">
                  <div class="marker-icon">üéØ</div>
                </div>
                <div class="timeline-content">
                  <h3>Results Ready</h3>
                  <p>View diagnosis & recommendations</p>
                  <span class="status-badge pending">Waiting</span>
                </div>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar-container">
              <div class="progress-bar">
                <div
                  class="progress-fill"
                  id="progressFill"
                  style="width: 50%"
                ></div>
              </div>
              <div class="progress-text">
                <span id="progressPercent">50%</span> Complete
              </div>
            </div>
          </section>
        </div>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <div class="container">
          <div class="previous-reports">
            <span>Analysis in progress...</span>
            <span class="arrow">‚Ä¢</span>
            <span>Please wait for results</span>
          </div>
        </div>
      </footer>
    </div>

    <script>
      // Updated script for page2.html to call your Flask API
function goBack() {
  window.location.href = "index.html";
}

async function callPredictionAPI() {
  try {
    const imageData = localStorage.getItem("imageBase64");
    if (!imageData) {
      throw new Error("No image data found");
    }

    console.log("Calling prediction API...");
    
    const response = await fetch("/api/predict", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        imageData: imageData,
      }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const result = await response.json();
    console.log("API Response:", result);

    if (result.success) {
      // Store the result for page3
      localStorage.setItem("diagnosisResult", JSON.stringify(result));
      return result;
    } else {
      throw new Error(result.error || "Prediction failed");
    }
  } catch (error) {
    console.error("API call failed:", error);
    // Store error result for page3
    const errorResult = {
      success: false,
      error: error.message,
      prediction: "Error",
      confidence_percentage: 0
    };
    localStorage.setItem("diagnosisResult", JSON.stringify(errorResult));
    throw error;
  }
}

function updateProgress() {
  const progressFill = document.getElementById("progressFill");
  const progressPercent = document.getElementById("progressPercent");

  // Start actual API call after initial animation
  setTimeout(async () => {
    try {
      progressFill.style.width = "75%";
      progressPercent.textContent = "75%";

      // Update timeline items
      const timelineItems = document.querySelectorAll(".timeline-item");

      // Complete second step (AI Analysis)
      timelineItems[1].classList.remove("active");
      timelineItems[1].classList.add("completed");

      // Update marker to show completion
      const secondMarker = timelineItems[1].querySelector(".marker-icon");
      secondMarker.innerHTML = "‚úì";

      // Update status badge
      const secondStatus = timelineItems[1].querySelector(".status-badge");
      secondStatus.textContent = "Complete";
      secondStatus.classList.remove("processing");
      secondStatus.classList.add("completed");

      // Activate third step (Generate Report)
      timelineItems[2].classList.add("active");
      const thirdStatus = timelineItems[2].querySelector(".status-badge");
      thirdStatus.textContent = "Processing...";
      thirdStatus.classList.remove("pending");
      thirdStatus.classList.add("processing");

      // Call your actual API here
      console.log("Making API call to your model...");
      await callPredictionAPI();
      console.log("API call completed successfully");

      setTimeout(() => {
        progressFill.style.width = "100%";
        progressPercent.textContent = "100%";

        // Complete third step
        timelineItems[2].classList.remove("active");
        timelineItems[2].classList.add("completed");

        // Update third step marker and status
        const thirdMarker = timelineItems[2].querySelector(".marker-icon");
        thirdMarker.innerHTML = "‚úì";
        thirdStatus.textContent = "Complete";
        thirdStatus.classList.remove("processing");
        thirdStatus.classList.add("completed");

        // Activate fourth step (Results Ready)
        timelineItems[3].classList.add("active");
        const fourthStatus = timelineItems[3].querySelector(".status-badge");
        fourthStatus.textContent = "Ready";
        fourthStatus.classList.remove("pending");
        fourthStatus.classList.add("processing");

        setTimeout(() => {
          // Complete analysis and redirect
          timelineItems[3].classList.remove("active");
          timelineItems[3].classList.add("completed");

          const fourthMarker = timelineItems[3].querySelector(".marker-icon");
          fourthMarker.innerHTML = "‚úì";
          fourthStatus.textContent = "Complete";
          fourthStatus.classList.remove("processing");
          fourthStatus.classList.add("completed");

          setTimeout(() => {
            window.location.href = "page3.html";
          }, 1000);
        }, 1500);
      }, 2000);
    } catch (error) {
      console.error("Analysis failed:", error);
      
      // Show error state
      const timelineItems = document.querySelectorAll(".timeline-item");
      timelineItems[1].classList.remove("active");
      timelineItems[1].classList.add("completed");
      
      // Update status to show error
      const secondStatus = timelineItems[1].querySelector(".status-badge");
      secondStatus.textContent = "Failed";
      secondStatus.classList.remove("processing");
      secondStatus.classList.add("error");
      
      // Still redirect to results page to show error
      setTimeout(() => {
        window.location.href = "page3.html";
      }, 2000);
    }
  }, 2000);
}

function toggleTheme() {
  const body = document.body;
  const lightIcon = document.querySelector(".theme-icon-light");
  const darkIcon = document.querySelector(".theme-icon-dark");

  body.classList.toggle("dark-theme");

  if (body.classList.contains("dark-theme")) {
    lightIcon.style.display = "none";
    darkIcon.style.display = "block";
    localStorage.setItem("theme", "dark");
  } else {
    lightIcon.style.display = "block";
    darkIcon.style.display = "none";
    localStorage.setItem("theme", "light");
  }
}

// Apply saved theme
const savedTheme = localStorage.getItem("theme");
if (savedTheme === "dark") {
  document.body.classList.add("dark-theme");
  document.querySelector(".theme-icon-light").style.display = "none";
  document.querySelector(".theme-icon-dark").style.display = "block";
}

// Start progress animation when page loads
window.addEventListener("load", () => {
  updateProgress();
});
    </script>
  </body>
</html>
